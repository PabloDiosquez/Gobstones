type ProtectoraDeAnimales is record {
/*
    PROP칍SITO: Modela una entidad protectora de animales.
    Inv. Rep.:
    * No hay dos animales con el mismo nombre.
    * No hay dos adoptantes con el mismo DNI
    * No hay dos cuidadores con el mismo nombre
    */

    field animales   // [Animal]
    field cuidadores // [Cuidador]
    field adopciones // [Adopcion]
    field adoptantes // [Adoptante]
}

type Animal is record {
/*
    PROP칍SITO: Modela un Animal.
    INV.REP:
    * El campo nombre no puede estar
    vacio
    * mesesDeEdad es un n칰mero mayor o
    igual a cero.
    */

    field nombre // String
    field especie // Especie
    field mesesDeEdad // N칰mero
    field vacunas // [Vacuna]
    field enRecuperacion // Booleano
}

type Adopci칩n is record {
/*
    PROP칍SITO: Modela una adopci칩n.
    INV.REP:
    * El campo dniAdoptante no puede estar
    vacio
    * El campo nombreAnimal no puede estar
    vacio
    */

    field dniAdoptante // String
    field nombreAnimal // String
    field fechaAdopcion // Fecha
}

type Cuidador is record {
/*
    PROP칍SITO: Modela un Cuidador.
    INV.REP:
    * El campo nombre no puede estar
    vac칤o
    * No hay dos animalesACargo
    iguales
    */

    field nombre // String
    field animalesACargo // [String]
}

type Especie is variant {
/*
    PROP칍SITO: Modela las especies de
    animales.
    */

    case Perro {}
    case Gato {}
    case Conejo {}
    case P치jaro {}
}

type TipoDeVacuna is variant {
/*
    PROP칍SITO: Modela los tipos de
    vacunas.
    */
    case Antirr치bica {}
    case TripleFelina {}
    case Polivalente {}
    case Moquillo {}
}

type Adoptante is record {
/*
    PROP칍SITO: Modela los adoptantes.
    INV.REP:
    * El campo dni no puede estar vac칤o
    * El campo tel칠fono no puede estar vac칤o
    * El campo direcci칩n no puede estar vac칤o
    */

    field dni // String
    field tel칠fono // String
    field direcci칩n // String
}

type Vacuna is record {
    /*
    PROP칍SITO: Modela una Vacuna.
    */

    field tipo // TipoDeVacuna
    field fechaAplicacion //Fecha
}

// Punto 1)
// Escriba la funci칩n protectoraConAnimalesVacunadosConAntirrabicaSiCorrespondeEn_ que dada una
// protectora, describe la protectora con todos los animales que tienen m치s de 2 meses de edad con la Antirr치bica
// incluida en sus vacunas, esta vacuna se aplica una unica vez, si ya fue aplicada, no debe aplicarse nuevamente.
// Para solucionar este problema puede hacer uso de la funci칩n primitiva contieneLaVacuna_En_, que dado un tipo
// de vacuna y una lista de vacunas, indica si la vacuna con el tipo dado existe en la lista dada.

function protectoraConAnimalesVacunadosConAntirrabicaSiCorrespondeEn_(protectora) {
    /*
        PROP칍SITO:
            * Describe la protectora de animales con todos los animales que tienen m치s de 2 meses de edad con la Antirr치bica inclu칤da en sus vacunas.
        PAR츼METROS:
            * protectora: ProtectoraDeAnimales
        TIPO: ProtectoraDeAnimales
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
        OBSERVACIONES:
            * Recorrido de transformaci칩n sobre la lista de animales de la protectora.
    */
    
    animalesDeM치sDeDosMesesConLaAntirr치bicaAlMomento := []

    foreach animal in animales(protectora) {
        animalesDeM치sDeDosMesesConLaAntirr치bicaAlMomento := animalesDeM치sDeDosMesesConLaAntirr치bicaAlMomento ++
        [animal_VacunadoCon_Si_(animal, Antirr치bica, _tieneM치sDe_MesesDeEdad(animal, 2) && not contieneLaVacuna_En_(Antirr치bica, vacunas(animal)))]
    }

    return (ProtectoraDeAnimales(protectora | animales <- animalesDeM치sDeDosMesesConLaAntirr치bicaAlMomento))
}

function animal_VacunadoCon_Si_(animal, tipoDeVacuna, condici칩n) {
    /*
        PROP칍SITO:
            * Describe el animal que resulta de aplicar la vacuna del tipo dado al animal dado si se cumple la condici칩n dada; en caso contrario, describe al animal original.
        PAR츼METROS:
            * animal: Animal
            * tipoDeVacuna: TipoDeVacuna
            * condici칩n: Booleano
        TIPO: Animal
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    return (choose Animal(animal | vacunas <- 
                                        vacunas(animal) ++ [vacunaDeTipo_En_(tipo, fechaActual())]) when (condici칩n)
                   animal otherwise
    )
    
}

function vacunaDeTipo_En_(tipoDeVacuna, fecha) {
    /*
        PROP칍SITO:
            * Describe la vacuna del tipo dado en la fecha dada.
        PAR츼METROS:
            * tipo: TipoDeVacuna
            * fecha: Fecha
        TIPO: Vacuna
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    return (
            Vacuna(
                tipo <- tipoDeVacuna
            ,   fechaAplicacion <- fecha
         )
    )
}

function _tieneM치sDe_MesesDeEdad(animal, meses) {
    /*
        PROP칍SITO:
            * Indica si la edad del animal dado es mayor al n칰mero de meses dado.
        PAR츼METROS:
            * animal: Animal
            * meses: N칰mero
        TIPO: Booleano
        PRECONDICIONES:
            * **meses** debe ser >= 0.
    */
    
    return (mesesDeEdad(animal) > meses)
}

// Punto 2)
// Escriba la funci칩n nombreDeAnimalesDisponiblesParaAdopcionEn_ que dada una protectora, describe una lista
// con los nombres de los animales que est치n aptos para ser adoptados. Un animal est치 apto para ser adoptado
// cuando tiene m치s de 2 meses de edad, no est치 en recuperaci칩n ,cuando entre sus vacunas tiene :
// - Para los gatos: La antirr치bica, la triple felina y la de moquillo
// - Para los perros: la antirr치bica, la polivalente y la del moquillo
// - para los conejos: la antirr치bica y el moquillo
// - para los p치jaros: ninguna.
// Como estrategia pensar una subtarea que dado un animal, reconoce la especie del animal y en base a esto evaluar
// si tiene las vacunas necesarias para ser adoptado.

function nombreDeAnimalesDisponiblesParaAdopcionEn_(protectora) {
    /*
        PROP칍SITO:
            * Describe una lista con los nombres de los animales que est치n aptos para ser adoptados en la protectora dada.
        PAR츼METROS:
            * protectora: ProtectoraDeAnimales
        TIPO: [String]
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
        OBSERVACIONES:
            * Recorrido de filtrado de los nombres de los animales de la protectora aptos para ser adoptados.
    */
    
    animalesAptosParaSerAdoptadosAlMomento := []

    foreach animal in animales(protectora) {
        animalesAptosParaSerAdoptadosAlMomento := animalesAptosParaSerAdoptadosAlMomento ++ 
        singular_Si_(animal, es_AptoParaSerAdoptado(animal))
    }

    return (nombresDe_(animalesAptosParaSerAdoptadosAlMomento))
}

function es_AptoParaSerAdoptado(animal) {
    /*
        PROP칍SITO:
            * Indica si el animal dado es apto para ser adoptado.
        PAR츼METROS:
            * animal: Animal
        TIPO: Booleano
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    return (_tieneM치sDe_MesesDeEdad(animal, 2) && not enRecuperacion(animal) && tiene_LasVacunasNecesariasParaSerAdoptado(animal))
}

function tiene_LasVacunasNecesariasParaSerAdoptado(animal) {
    /*
        PROP칍SITO:
            * Indica si el animal dado tiene las vacunas para ser adoptado, seg칰n los requerimientos de su especie.
        PAR츼METROS:
            * animal: Animal
        TIPO: Booleano
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
        OBSERVACIONES:
            * Recorrido de b칰squeda sobre la lista de tipos de vacunas necesarias para la adopci칩n del animal dado.
    */

    vacunasNecesariasPorRecorrer := vacunasDe_NecesariasParaSerAdoptado(animal)

    while (not esVac칤a(vacunasNecesariasPorRecorrer) && contieneLaVacuna_En_(primero(vacunasNecesariasPorRecorrer, vacunas(animal)))) {
        vacunasNecesariasPorRecorrer := resto(vacunasNecesariasPorRecorrer)
    }

    return (esVac칤a(vacunasNecesariasPorRecorrer))
}

function vacunasDe_NecesariasParaSerAdoptado(animal) {
    /*
        PROP칍SITO:
            * Describe la lista de los tipos de vacunas necesarias para que el animal dado est칠 apto para ser adoptado, seg칰n los requerimientos de su especie.
        PAR츼METROS:
            * animal: Animal
        TIPO: [TipoDeVacuna]
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    return (choose [Antirr치bica, TripleFelina, Moquillo] when (esGato(animal))
                   [Antirr치bica, Polivalente, Moquillo]  when (esPerro(animal))
                   [Antirr치bica, Moquillo]               when (esConejo(animal))
                   []                                    otherwise 
    )
}

function nombresDe_(animales) {
    /*
        PROP칍SITO:
            * Describe la lista de nombres de los animales dados.
        PAR츼METROS:
            * animales: [Animal]
        TIPO: [String]
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    nombresDeLosAnimalesAlMomento := []

    foreach animal in animales {
        nombresDeLosAnimalesAlMomento := nombresDeLosAnimalesAlMomento ++ [nombre(animal)]
    }

    return (nombresDeLosAnimalesAlMomento)
}

function esGato(animal) {
    /*
        PROP칍SITO:
            * Indica si el animal dado es un gato.
        PAR츼METROS:
            * animal: Animal
        TIPO: Booleano
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    return (especie(animal) == Gato)
}

function esPerro(animal) {
    /*
        PROP칍SITO:
            * Indica si el animal dado es un perro.
        PAR츼METROS:
            * animal: Animal
        TIPO: Booleano
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    return (especie(animal) == Perro)
}

function esGato(animal) {
    /*
        PROP칍SITO:
            * Indica si el animal dado es un conejo.
        PAR츼METROS:
            * animal: Animal
        TIPO: Booleano
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    return (especie(animal) == Conejo)
}

// Punto 3)
// Escriba la funci칩n animalesDelCuidador_QueFueronAdoptadosEn_ que dado el nombre de un cuidador y
// una protectora, describe la lista de animales que fueron adoptados y estaban a cargo del cuidador dado. Tener en
// cuenta que podr칤an existir cuidadores que aun no participaron de ninguna adopci칩n.

function animalesDelCuidador_QueFueronAdoptadosEn_(nombreCuidador, protectora) {
    /*
        PROP칍SITO:
            * Describe la lista de animales que fueron adoptados y que estaban a cargo del cuidador dado.
        PAR츼METROS:
            * nombreCuidador: String
            * protectora: ProtectoraDeAnimales
        TIPO: [Animal]
        PRECONDICIONES:
            * Debe existir el cuidador con el nombre dado en la protectora.
    */
    
    animalesAdoptadosCuidadosPorElCuidadorDado := []

    foreach animal in animales(protectora) {
        animalesAdoptadosCuidadosPorElCuidadorDado := animalesAdoptadosCuidadosPorElCuidadorDado ++
        singular_Si_(animal, _FueAdoptadoEn_(animal, protectora) && _EstabaACargoDe_En_(animal, nombreCuidador, protectora))
    }

    return (animalesAdoptadosCuidadosPorElCuidadorDado)
}

function _FueAdoptadoEn_(animal, protectora) {
    /*
        PROP칍SITO:
            * Indica si el animal figura en la lista de adopciones de la protectora.
        PAR츼METROS:
            * animal: Animal
            * protectora: ProtectoraDeAnimales
        TIPO: Booleano
        PRECONDICIONES:
            * No tiene (es una funci칩n total).
    */
    
    adopcionesPorRecorrer := adopciones(protectora) 

    while (not esVac칤a(adopcionesPorRecorrer) && nombreAnimal(primero(adopcionesPorRecorrer)) /= nombre(animal)) {
        adopcionesPorRecorrer := resto(adopcionesPorRecorrer)
    }

    return (not esVac칤a(adopcionesPorRecorrer))
}

function _EstabaACargoDe_En_(animal, nombreCuidador, protectora) {
    /*
        PROP칍SITO:
            * Indica si el animal dado estaba a cargo del cuidador de nombre dado en la protectora de animales dada.
        PAR츼METROS:
            * animal: Animal
            * nombreCuidador: String
            * protectora: ProtectoraDeAnimales
        TIPO: Booleano
        PRECONDICIONES:
            * Debe existir el cuidador con el nombre dado en la protectora.
    */
    
    cuidadoresPorRecorrer := cuidadores(protectora)

    while (not esVac칤a(cuidadoresPorRecorrer) && not contiene_A_(nombre(animal), animalesACargo(cuidador))) {
        cuidadoresPorRecorrer := resto(cuidadores)
    }

    return (not esVac칤a(cuidadoresPorRecorrer))
}

// SOLUCI칍N AUXILIAR 游때

function animalesDelCuidador_QueFueronadoptadosEn_(cuidador,protectora){
    /*  Proposito: describe una lista de animales de la protectora dada que fueron adoptados y estaban a cargo del cuidador dado.
        Precondicion: los cuidadores a evaluar participaron de la adopcion. tiene que existir el cuidador con el nombre dado.
        Parametros: cuidador: Cuidador
                    protectora: ProtectoraDeAnimales
        Tipo: [animales]
        Observaciones: es un recorrido de filtro.*/
    animalesAdoptados := []
    foreach animal in animales(protectora) {
        animalesAdoptados := animalesAdoptados ++ singular_Si_(animal, animal_FueAdoptadoEn_QueFueCuidadoPor_(animal,protectora,cuidador))
    }
    return(animalesAdoptados)
}
function animal_FueAdoptadoEn_QueFueCuidadoPor_(protectora,cuidador){
    /*  Proposito: indica si el animal "animal" dado fue adoptado en la "protectora" dada y que estuvo a cargo del "cuidador" dado.
        Precondiciones: ninguna.
        Parametros: protectora: Protectora.
                    cuidador: Cuidador.
                    animal: Animal
        Tipo: Booleano.*/
    return(es_AdoptadoEn_(animal,protectora) && es_CuidadoPor_(animal,cuidador))
}
function es_AdoptadoEn_(animal,protectora){
    /*   Proposito: indica si el "animal" dado figura dentro del listado de adopciones de la "protectora" dada.
        Precondiciones: ninguna.
        Parametros: animal:Animal
                    protectora: ProtectoraDeAnimales
        Tipo: Booleano.*/
    listaDeAnimalesARecorrer := animales(protectora)
    while (not esVac칤a(listaDeAnimalesARecorrer) && nombre(animal) /= (nombre(primero(listaDeAnimalesARecorrer)))) {
        listaDeAnimalesARecorrer := resto(listaDeAnimalesARecorrer)
    }
    return (not esVac칤a(listaDeAnimalesARecorrer))
}
function es_CuidadoPor_(animal,cuidador){
    /*  Proposito: indica si el "animal" dado fue estuvo a cargo del "cuidador" dado.
        Precondicion: ninguna
        Parametros: animal: Animal.
                    cuidador: Cuidador.
        Tipo: Booleano.*/
    listaDeAnimalesARecorrer := animalesACargo(cuidador)
    while (not esVac칤a(listaDeAnimalesARecorrer) && nombre(animal) /= (nombre(primero(listaDeAnimalesARecorrer)))) {
        listaDeAnimalesARecorrer := resto(listaDeAnimalesARecorrer)
    }
    return (not esVac칤a(listaDeAnimalesARecorrer))
}


// Punto 4) (Extra)
// Escriba la funcion animalesRecuperadosAdoptadosPor_En_ que dado una lista de dnis de adoptantes
// comprometidos con la protectora y que se ofrecieron a cuidar animales animales que a칰n no se recuperaron y una
// protectora, describiendo una lista de esos animales que ahora se encuentran recuperados.

function animalesRecuperadosAdoptadosPor_En_(dnisAdoptantes, protectora) {
    /*
        PROP칍SITO:
            * Describe una lista de animales que fueron adoptados por los adoptantes de dnis dados en la protectora dada y ahora se encuentran recuperados.
        PAR츼METROS:
            * dnisAdoptadores: [N칰mero]
            * protectora: ProtectoraDeAnimales
        TIPO: [Animal]
        PRECONDICIONES:
            * Los dnis de los adoptantes dados deben figurar en las adopciones de la protectora dada.
            * Los adoptantes en la lista deben tener una adopcion.
    */
    
    nombresAnimalesAdoptadosYRecuperadosAlMomento := []

    foreach adopci칩n in adopciones(protectora) {
        nombresAnimalesAdoptadosYRecuperadosAlMomento := nombresAnimalesAdoptadosYRecuperadosAlMomento ++
        singular_Si_(nombreAnimal(adopci칩n), contiene_A_(dniAdoptante(adopci칩n), dnisAdoptantes) && not est치ElAnimalDeNombre_EnLaProtectora_EnRecuperaci칩n(nombreAnimal(adopci칩n), protectora))
    }

    return (animalesDeNombres_EnLaProtectora_(nombresAnimalesAdoptadosYRecuperadosAlMomento, protectora))
}

function est치ElAnimalDeNombre_EnLaProtectora_EnRecuperaci칩n(nombreAnimal, protectora) {
    /*
        PROP칍SITO:
            * Indica si el animal de nombre dado est치 en recuperaci칩n en la protectora dada.
        PAR츼METROS:
            * nombreAnimal: String
            * protectora: ProtectoraDeAnimales
        TIPO: Booleano
        PRECONDICIONES:
            * **nombreAnimal** debe existir en la protectora dada.
        OBSERVACIONES: 
            * Recorrido de filtro sobre la lista de adopciones de la protectora dada.
    */
    
    animalesPorVer := animales(protectora)

    while (nombre(primero(animalesPorVer)) /= nombreAnimal) {
        animalesPorVer := resto(animalesPorVer)
    }

    return (enRecuperacion(primero(animalesPorVer)))
}

// SOLUCI칍N AUXILIAR 游때

function animalesRecuperadosAdoptadosPor_En_(listaDnisAdoptantes, protectora){
    /*
        PROPOSITO: 
            * Describe los animales que fueron adoptados por 
            adoptantes responsables con dnis **listaDNISApdoptantes**
            y ahora estan recuperados.
        PRECONDICIONES:
            * Los adoptantes responsables s칩lo tienen una adopci칩n.
            * Los dnis de los adoptantes deben deben ser de adoptantes de la protectora.
            * Los adoptantes en la lista deben tener una adopci칩n.
        PARAMETROS:
            * listaDNISAdoptantes: [String]
            * protectora: ProtectoraDeAnimales
        TIPO: [Animal]
        OBSERVACIONES: 
            * Recorrido de filtro sobre la lista de animales de la protectora dada.
    */
    
    animalesRecuperadosPorAdoptante := []
    
    foreach animal in animales(protectora){
        animalesRecuperadosPorAdoptante := animalesRecuperadosPorAdoptante ++ 
            singular_Si_(animal, esAnimal_RecuperadoYPerteneceAUnAdoptanteDe_En_(animal,listaDnisAdoptantes,protectora))
    }
    
    return(animalesRecuperadosPorAdoptante)
    
}


function esAnimal_RecuperadoYPerteneceAUnAdoptanteDe_En_(animal, listaDnisAdoptantes, protectora){
    /*
        PROPOSITO: 
            * Indica si el animal dado est치 recuperado y pertenece a alguno de los adoptantes de la lista dada.
        PRECONDICIONES:
            * El animal pertenece a la protectora dada.
        PARAMETROS:
            * listaDnisAdoptantes: [String]
            * protectora: ProtectoraDeAnimales
        TIPO: [Animal]
    */    

    return(not enRecuperacion(animal) && estaAdoptado_En_(animal, protectora) &&
        contiene_A_(listaDNSAdpotantes, dniAdoptante(adopci칩nDel_En_(animal, protectora)))
    )

}

function est치Adoptado_En_(animal, protectora){
    /**/
    
    adopcionesARecorrer := adopciones(protectora)
    
    while(not esVac칤a(adopcionesARecorrer) && not esAdopci칩n_DelAnimal_(primero(adopcionesARecorrer), animal)   ){
        adopcionesARecorrer := resto(adopcionesARecorrer)
    }
    
    return(not esVac칤a(adopcionesARecorrer))
    
}


function esAdopci칩n_DelAnimal_(adopci칩n, animal){
    /**/
    
    return(nombreAnimal(adopci칩n) == nombre(animal))
}


function adopci칩nDel_En_(animal, protectora){
    /**/
    adopcionesARecorrer := adopciones(protectora)
    
    while(not esAdopci칩n_DelAnimal_(primero(adopcionesARecorrer), animal)){
        adopcionesARecorrer := resto(adopcionesARecorrer)
    }
    
    return(primero(adopcionesARecorrer))
}